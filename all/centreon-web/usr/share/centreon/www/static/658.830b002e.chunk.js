(self.webpackChunkname=self.webpackChunkname||[]).push([[658],{48658:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>D});var i=s(67294),n=s(14494),a=s(81375),l=s(31417),o=s(68996),d=s(803),h=s(74720),c=s(94530),r=s(76267),u=s(62728),g=s(66791),m=s(14319),y=s(68507);class p extends i.Component{constructor(){super(...arguments),this.state={deleteToggled:!1,deletingEntity:!1,extensionDetails:!1,extensions:{module:{entities:[]},widget:{entities:[]}},extensionsInstallingStatus:{},extensionsUpdatingStatus:{},installed:!1,modalDetailsActive:!1,modalDetailsLoading:!1,modalDetailsType:"module",modulesActive:!1,not_installed:!1,search:"",updated:!1,widgetsActive:!1},this.componentDidMount=()=>{this.getData()},this.onChange=(t,e)=>{const{filters:s}=this.state,i={};void 0!==this.state[e]&&(i[e]=t),this.setState(Object.assign(Object.assign({},i),{filters:Object.assign(Object.assign({},s),{[e]:t})}),this.getData)},this.clearFilters=()=>{this.setState({installed:!1,modulesActive:!1,not_installed:!1,nothingShown:!1,search:"",updated:!1,widgetsActive:!1},this.getData)},this.getEntitiesByKeyAndVersionParam=(t,e,s,i)=>{const{extensions:n}=this.state,a=[];if(n){const{status:i,result:l}=n;if(i)for(let i=0;i<l[s].entities.length;i++){const n=l[s].entities[i];n.version[t]===e&&a.push({id:n.id,type:s})}}i(a)},this.getAllEntitiesByVersionParam=(t,e,s)=>{const{modulesActive:i,widgetsActive:n}=this.state;!i&&!n||i&&n?this.getEntitiesByKeyAndVersionParam(t,e,"module",(i=>{this.getEntitiesByKeyAndVersionParam(t,e,"widget",(t=>{s&&s([...i,...t])}))})):i?this.getEntitiesByKeyAndVersionParam(t,e,"module",(t=>{s&&s([...t])})):n&&this.getEntitiesByKeyAndVersionParam(t,e,"widget",(t=>{s&&s([...t])}))},this.runActionOnAllEntities=(t,e,s)=>{this.getAllEntitiesByVersionParam(t,e,(e=>{this.setStatusesByIds(e,s,(()=>{"outdated"===t?this.updateOneByOne(e):"installed"===t&&this.installOneByOne(e)}))}))},this.reloadNavigation=()=>{const{reloadNavigation:t}=this.props;t()},this.reloadExternalComponents=()=>{const{reloadExternalComponents:t}=this.props;t()},this.setStatusesByIds=(t,e,s)=>{let i=this.state[e];for(const{id:e}of t)i=Object.assign(Object.assign({},i),{[e]:!0});this.setState({[e]:i},s)},this.updateOneByOne=t=>{if(t.length>0){const e=t.shift();this.updateById(e.id,e.type,(()=>{this.updateOneByOne(t)}))}},this.installOneByOne=t=>{if(t.length>0){const e=t.shift();this.installById(e.id,e.type,(()=>{this.installOneByOne(t)}))}},this.setStatusByKey=(t,e,s)=>{this.setState({[t]:Object.assign(Object.assign({},this.state[t]),{[e]:!1})},(()=>{s&&"function"==typeof s&&s()}))},this.runAction=(t,e,s,i,n)=>{this.setStatusesByIds([{id:s}],t,(()=>{(0,g.Z)(`internal.php?object=centreon_module&action=${e}&id=${s}&type=${i}`).post().then((()=>{this.getData((()=>{this.setStatusByKey(t,s,n),this.reloadNavigation()}))})).catch((e=>{throw this.getData((()=>{this.setStatusByKey(t,s,n),this.reloadNavigation()})),e}))}))},this.installById=(t,e,s)=>{const{modalDetailsActive:i}=this.state;i?(this.setState({modalDetailsLoading:!0}),this.runAction("extensionsInstallingStatus","install",t,e,(()=>{this.getExtensionDetails(t,e)}))):this.runAction("extensionsInstallingStatus","install",t,e,s)},this.updateById=(t,e,s)=>{const{modalDetailsActive:i}=this.state;i?(this.setState({modalDetailsLoading:!0}),this.runAction("extensionsUpdatingStatus","update",t,e,(()=>{this.getExtensionDetails(t,e)}))):this.runAction("extensionsUpdatingStatus","update",t,e,s)},this.deleteById=(t,e)=>{const{modalDetailsActive:s}=this.state;this.setState({deleteToggled:!1,deletingEntity:!1,modalDetailsLoading:s},(()=>{(0,g.Z)("internal.php?object=centreon_module&action=remove").delete("",{params:{id:t,type:e}}).then((()=>{this.getData(),this.reloadNavigation(),s&&this.getExtensionDetails(t,e)}))}))},this.toggleDeleteModal=(t,e)=>{const{deleteToggled:s}=this.state;this.setState({deleteToggled:!s,deletingEntity:!!t&&Object.assign(Object.assign({},t),{type:e})})},this.getParsedGETParamsForExtensions=t=>{const{installed:e,not_installed:s,updated:i,search:n}=this.state;let a="";const l=!1;n&&(a+=`&search=${n}`),e&&s&&i?t(a,l):e||s||i?(i&&(a+="&updated=false"),!e&&s?a+="&installed=false":e&&!s&&(a+="&installed=true"),t(a,l)):t(a,l)},this.getData=t=>{this.getParsedGETParamsForExtensions(((e,s)=>{this.setState({nothingShown:s}),s||(0,g.Z)(`internal.php?object=centreon_module&action=list${e}`).get().then((({data:e})=>{this.setState({extensions:e},(()=>{t&&"function"==typeof t&&t()}))}))}))},this.hideExtensionDetails=()=>{this.setState({modalDetailsActive:!1,modalDetailsLoading:!1})},this.activateExtensionsDetails=(t,e)=>{this.setState({modalDetailsActive:!0,modalDetailsLoading:!0,modalDetailsType:e},(()=>{this.getExtensionDetails(t,e)}))},this.getExtensionDetails=(t,e)=>{(0,g.Z)(`internal.php?object=centreon_module&action=details&type=${e}&id=${t}`).get().then((({data:t})=>{const{result:e}=t;e.images&&(e.images=e.images.map((t=>`./${t}`))),this.setState({extensionDetails:e,modalDetailsLoading:!1})}))},this.getEntityByIdAndType=(t,e)=>{const{extensions:s}=this.state;return"module"===e?s.result.module.entities.find((e=>e.id===t)):s.result.widget.entities.find((e=>e.id===t))},this.toggleDeleteModalByIdAndType=(t,e)=>{const s=this.getEntityByIdAndType(t,e);this.toggleDeleteModal(s,e)}}render(){const{extensions:t,modulesActive:e,deleteToggled:s,widgetsActive:n,not_installed:a,installed:g,updated:m,search:y,nothingShown:p,modalDetailsActive:D,modalDetailsLoading:E,modalDetailsType:x,extensionsUpdatingStatus:A,extensionsInstallingStatus:S,deletingEntity:v,extensionDetails:b}=this.state,B=(g&&a&&m||!g&&!a&&!m)&&0===y.length&&(e&&n||!e&&!n);return i.createElement("div",null,i.createElement(l.Z,{fullText:{filterKey:"search",label:"Search",value:y},switches:[[{customClass:"container__col-md-4 container__col-xs-4",filterKey:"not_installed",switchStatus:"Not installed",switchTitle:"Status",value:a},{customClass:"container__col-md-4 container__col-xs-4",filterKey:"installed",switchStatus:"Installed",value:g},{customClass:"container__col-md-4 container__col-xs-4",filterKey:"updated",switchStatus:"Outdated",value:m}],[{customClass:"container__col-sm-3 container__col-xs-4",filterKey:"modulesActive",switchStatus:"Module",switchTitle:"Type",value:e},{customClass:"container__col-sm-3 container__col-xs-4",filterKey:"widgetsActive",switchStatus:"Widget",value:n},{button:!0,buttonType:"bordered",color:"black",label:"Clear Filters",onClick:this.clearFilters.bind(this)}]],onChange:this.onChange.bind(this)}),i.createElement(o.Z,null,i.createElement(d.Z,{buttonType:"regular",color:"orange",customClass:"mr-2",label:B?"Update all":"Update selection",style:{opacity:"1"},onClick:this.runActionOnAllEntities.bind(this,"outdated",!0,"extensionsUpdatingStatus")}),i.createElement(d.Z,{buttonType:"regular",color:"green",customClass:"mr-2",label:B?"Install all":"Install selection",onClick:this.runActionOnAllEntities.bind(this,"installed",!1,"extensionsInstallingStatus")}),i.createElement(u.Z,{path:"/administration/extensions/manager"})),t.result&&!p?i.createElement(i.Fragment,null,t.result.module&&(e||!e&&!n)?i.createElement(h.Z,{entities:t.result.module.entities,installing:S,title:"Modules",type:"module",updating:A,onCardClicked:this.activateExtensionsDetails,onDelete:this.toggleDeleteModal,onInstall:this.installById,onUpdate:this.updateById}):null,t.result.widget&&(n||!e&&!n)?i.createElement(h.Z,{entities:t.result.widget.entities,hrColor:"blue",hrTitleColor:"blue",installing:S,title:"Widgets",titleColor:"blue",type:"widget",updating:A,onCardClicked:this.activateExtensionsDetails,onDelete:this.toggleDeleteModal,onInstall:this.installById,onUpdate:this.updateById}):null):null,b&&D?i.createElement(c.Z,{loading:E,modalDetails:b,type:x,onCloseClicked:this.hideExtensionDetails.bind(this),onDeleteClicked:this.toggleDeleteModalByIdAndType,onInstallClicked:this.installById,onUpdateClicked:this.updateById}):null,s?i.createElement(r.Z,{deletingEntity:v,onCancel:this.toggleDeleteModal,onConfirm:this.deleteById}):null)}}const D=(0,n.connect)(null,(t=>({reloadNavigation:()=>{t((0,a.$C)([(0,m.pk)(),(0,y.bU)()]))}})))(p)}}]);